function anError(e){var t=document.createElement("div");t.className="pn-info-box";var a=document.createElement("p");a.textContent=e,t.appendChild(a),document.getElementById("container").appendChild(t)}var viewer;function parseURLParameters(){var e;if(e=window.location.hash.length>0?window.location.hash.slice(1):window.location.search.slice(1)){e=e.split("&");for(var t,a={},o=0;o<e.length;o++){var n=e[o].split("=")[0],i=e[o].split("=")[1];if(""!=i)switch(n){case"hfov":case"pitch":case"yaw":case"haov":case"vaov":case"minHfov":case"maxHfov":case"minPitch":case"maxPitch":case"minYaw":case"maxYaw":case"vOffset":case"autoRotate":a[n]=Number(i);break;case"autoLoad":case"ignoreGPanoXMP":a[n]=JSON.parse(i);break;case"author":case"title":case"firstScene":case"fallback":case"preview":case"panorama":case"config":a[n]=decodeURIComponent(i);break;default:return void anError("An invalid configuration parameter was specified: "+n)}}if(a.config)return(t=new XMLHttpRequest).onload=function(){if(200!=t.status){var e=document.createElement("a");return e.href=a.config,e.textContent=e.href,void anError("The file "+e.outerHTML+" could not be accessed.")}var o=JSON.parse(t.responseText);void 0===o.basePath&&(o.basePath=a.config.substring(0,a.config.lastIndexOf("/")+1));for(var n in o)a.hasOwnProperty(n)||(a[n]=o[n]);"title"in a&&(document.title=a.title),a.escapeHTML=!0,viewer=pn.viewer("container",a)},t.open("GET",a.config),void t.send();"title"in a&&(document.title=a.title),a.escapeHTML=!0,viewer=pn.viewer("container",a)}else anError("No configuration options were specified.")}window.libpn=function(e,t,a){"use strict";function o(o){var r,c,d,u,f,p,m,v,g,w,y,b,x,E,M,P,R=t.createElement("canvas");function _(e,t){return 1==e.level&&1!=t.level?-1:1==t.level&&1!=e.level?1:t.timestamp-e.timestamp}function T(e,t){return e.level!=t.level?e.level-t.level:e.diff-t.diff}function L(e,t,a,o,n,i){this.vertices=e,this.side=t,this.level=a,this.x=o,this.y=n,this.path=i.replace("%s",t).replace("%l",a).replace("%x",o).replace("%y",n)}function C(e,t,a,o,n){if(function(e,t){var a=k(e,t.slice(0,3)),o=k(e,t.slice(3,6)),n=k(e,t.slice(6,9)),i=k(e,t.slice(9,12)),r=a[0]+o[0]+n[0]+i[0];if(-4==r||4==r)return!1;var s=a[1]+o[1]+n[1]+i[1];return-4!=s&&4!=s&&a[2]+o[2]+n[2]+i[2]!=4}(e,t.vertices)){var i=t.vertices,s=i[0]+i[3]+i[6]+i[9],l=i[1]+i[4]+i[7]+i[10],h=i[2]+i[5]+i[8]+i[11],c=Math.sqrt(s*s+l*l+h*h),d=Math.asin(h/c),u=Math.atan2(l,s)-o;u+=u>Math.PI?-2*Math.PI:u<-Math.PI?2*Math.PI:0,u=Math.abs(u),t.diff=Math.acos(Math.sin(a)*Math.sin(d)+Math.cos(a)*Math.cos(d)*Math.cos(u));for(var f=!1,p=0;p<r.nodeCache.length;p++)if(r.nodeCache[p].path==t.path){f=!0,r.nodeCache[p].timestamp=r.nodeCacheTimestamp++,r.nodeCache[p].diff=t.diff,r.currentNodes.push(r.nodeCache[p]);break}if(f||(t.timestamp=r.nodeCacheTimestamp++,r.currentNodes.push(t),r.nodeCache.push(t)),t.level<r.level){var m=g.cubeResolution*Math.pow(2,t.level-g.maxLevel),v=Math.ceil(m*g.invTileResolution)-1,w=m%g.tileResolution*2,y=2*m%g.tileResolution;0===y&&(y=g.tileResolution),0===w&&(w=2*g.tileResolution);var b=.5;t.x!=v&&t.y!=v||(b=1-g.tileResolution/(g.tileResolution+y));var x,E=1-b,M=[],P=b,R=b,_=b,T=E,I=E,A=E;y<g.tileResolution&&(t.x==v&&t.y!=v?(R=.5,I=.5,"d"!=t.side&&"u"!=t.side||(_=.5,A=.5)):t.x!=v&&t.y==v&&(P=.5,T=.5,"l"!=t.side&&"r"!=t.side||(_=.5,A=.5))),w<=g.tileResolution&&(t.x==v&&(P=0,T=1,"l"!=t.side&&"r"!=t.side||(_=0,A=1)),t.y==v&&(R=0,I=1,"d"!=t.side&&"u"!=t.side||(_=0,A=1))),x=new L([i[0],i[1],i[2],i[0]*P+i[3]*T,i[1]*b+i[4]*E,i[2]*_+i[5]*A,i[0]*P+i[6]*T,i[1]*R+i[7]*I,i[2]*_+i[8]*A,i[0]*b+i[9]*E,i[1]*R+i[10]*I,i[2]*_+i[11]*A],t.side,t.level+1,2*t.x,2*t.y,g.fullpath),M.push(x),t.x==v&&w<=g.tileResolution||(x=new L([i[0]*P+i[3]*T,i[1]*b+i[4]*E,i[2]*_+i[5]*A,i[3],i[4],i[5],i[3]*b+i[6]*E,i[4]*R+i[7]*I,i[5]*_+i[8]*A,i[0]*P+i[6]*T,i[1]*R+i[7]*I,i[2]*_+i[8]*A],t.side,t.level+1,2*t.x+1,2*t.y,g.fullpath),M.push(x)),t.x==v&&w<=g.tileResolution||t.y==v&&w<=g.tileResolution||(x=new L([i[0]*P+i[6]*T,i[1]*R+i[7]*I,i[2]*_+i[8]*A,i[3]*b+i[6]*E,i[4]*R+i[7]*I,i[5]*_+i[8]*A,i[6],i[7],i[8],i[9]*P+i[6]*T,i[10]*b+i[7]*E,i[11]*_+i[8]*A],t.side,t.level+1,2*t.x+1,2*t.y+1,g.fullpath),M.push(x)),t.y==v&&w<=g.tileResolution||(x=new L([i[0]*b+i[9]*E,i[1]*R+i[10]*I,i[2]*_+i[11]*A,i[0]*P+i[6]*T,i[1]*R+i[7]*I,i[2]*_+i[8]*A,i[9]*P+i[6]*T,i[10]*b+i[7]*E,i[11]*_+i[8]*A,i[9],i[10],i[11]],t.side,t.level+1,2*t.x,2*t.y+1,g.fullpath),M.push(x));for(var S=0;S<M.length;S++)C(e,M[S],a,o,n)}}}function I(e,t,a){var o=Math.sin(t),n=Math.cos(t);return"x"==a?[e[0],n*e[1]+o*e[2],n*e[2]-o*e[1],e[3],n*e[4]+o*e[5],n*e[5]-o*e[4],e[6],n*e[7]+o*e[8],n*e[8]-o*e[7]]:"y"==a?[n*e[0]-o*e[2],e[1],n*e[2]+o*e[0],n*e[3]-o*e[5],e[4],n*e[5]+o*e[3],n*e[6]-o*e[8],e[7],n*e[8]+o*e[6]]:"z"==a?[n*e[0]+o*e[1],n*e[1]-o*e[0],e[2],n*e[3]+o*e[4],n*e[4]-o*e[3],e[5],n*e[6]+o*e[7],n*e[7]-o*e[6],e[8]]:void 0}function A(e){return[e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]]}R.style.width=R.style.height="100%",o.appendChild(R),this.init=function(e,_,T,L,C,I,A,S){if(_===a&&(_="equirectangular"),"equirectangular"!=_&&"cubemap"!=_&&"multires"!=_)throw console.log("Error: invalid image type specified!"),{type:"config error"};if(w=_,g=e,y=T,P=S||{},r){if(d&&(c.detachShader(r,d),c.deleteShader(d)),u&&(c.detachShader(r,u),c.deleteShader(u)),c.bindBuffer(c.ARRAY_BUFFER,null),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,null),r.texture&&c.deleteTexture(r.texture),r.nodeCache)for(var D=0;D<r.nodeCache.length;D++)c.deleteTexture(r.nodeCache[D].texture);c.deleteProgram(r),r=a}var N;v=a;var k,U=!1;if("cubemap"==w)for(N=0;N<6;N++)g[N].width>0?(k===a&&(k=g[N].width),k!=g[N].width&&console.log("Cube faces have inconsistent widths: "+k+" vs. "+g[N].width)):U=!0;function F(e){if(U){var t=e*e*4,a=new Uint8ClampedArray(t),o=S.backgroundColor?S.backgroundColor:[0,0,0];o[0]*=255,o[1]*=255,o[2]*=255;for(var n=0;n<t;n++)a[n++]=o[0],a[n++]=o[1],a[n++]=o[2];var i=new ImageData(a,e,e);for(N=0;N<6;N++)0==g[N].width&&(g[N]=i)}}if("cubemap"==w&&0!=(k&k-1)&&(navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 8_/)||navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 9_/)||navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 10_/)||navigator.userAgent.match(/Trident.*rv[ :]*11\./))||(c||(c=R.getContext("experimental-webgl",{alpha:!1,depth:!1})),c&&1286==c.getError()&&O()),!c&&("multires"==w&&g.hasOwnProperty("fallbackPath")||"cubemap"==w)&&("WebkitAppearance"in t.documentElement.style||navigator.userAgent.match(/Trident.*rv[ :]*11\./)||-1!==navigator.appVersion.indexOf("MSIE 10"))){var B;p&&o.removeChild(p),(p=t.createElement("div")).className="pn-world",B=g.basePath?g.basePath+g.fallbackPath:g.fallbackPath;var z=["f","r","b","l","u","d"],H=0,G=function(){var e=t.createElement("canvas");e.className="pn-face pn-"+z[this.side]+"face",p.appendChild(e);var a=e.getContext("2d");e.style.width=this.width+4+"px",e.style.height=this.height+4+"px",e.width=this.width+4,e.height=this.height+4,a.drawImage(this,2,2);var o,n,i=a.getImageData(0,0,e.width,e.height),r=i.data;for(o=2;o<e.width-2;o++)for(n=0;n<4;n++)r[4*(o+e.width)+n]=r[4*(o+2*e.width)+n],r[4*(o+e.width*(e.height-2))+n]=r[4*(o+e.width*(e.height-3))+n];for(o=2;o<e.height-2;o++)for(n=0;n<4;n++)r[4*(o*e.width+1)+n]=r[4*(o*e.width+2)+n],r[4*((o+1)*e.width-2)+n]=r[4*((o+1)*e.width-3)+n];for(n=0;n<4;n++)r[4*(e.width+1)+n]=r[4*(2*e.width+2)+n],r[4*(2*e.width-2)+n]=r[4*(3*e.width-3)+n],r[4*(e.width*(e.height-2)+1)+n]=r[4*(e.width*(e.height-3)+2)+n],r[4*(e.width*(e.height-1)-2)+n]=r[4*(e.width*(e.height-2)-3)+n];for(o=1;o<e.width-1;o++)for(n=0;n<4;n++)r[4*o+n]=r[4*(o+e.width)+n],r[4*(o+e.width*(e.height-1))+n]=r[4*(o+e.width*(e.height-2))+n];for(o=1;o<e.height-1;o++)for(n=0;n<4;n++)r[o*e.width*4+n]=r[4*(o*e.width+1)+n],r[4*((o+1)*e.width-1)+n]=r[4*((o+1)*e.width-2)+n];for(n=0;n<4;n++)r[n]=r[4*(e.width+1)+n],r[4*(e.width-1)+n]=r[4*(2*e.width-2)+n],r[e.width*(e.height-1)*4+n]=r[4*(e.width*(e.height-2)+1)+n],r[4*(e.width*e.height-1)+n]=r[4*(e.width*(e.height-1)-2)+n];a.putImageData(i,0,0),Y.call(this)},Y=function(){this.width>0?(f===a&&(f=this.width),f!=this.width&&console.log("Fallback faces have inconsistent widths: "+f+" vs. "+this.width)):U=!0,6==++H&&(f=this.width,o.appendChild(p),A())};for(U=!1,N=0;N<6;N++){var X=new Image;X.crossOrigin=P.crossOrigin?P.crossOrigin:"anonymous",X.side=N,X.onload=G,X.onerror=Y,X.src="multires"==w?encodeURI(B.replace("%s",z[N])+"."+g.extension):encodeURI(g[N].src)}F(f)}else{if(!c)throw console.log("Error: no WebGL support detected!"),{type:"no webgl"};"cubemap"==w&&F(k),g.basePath?g.fullpath=g.basePath+g.path:g.fullpath=g.path,g.invTileResolution=1/g.tileResolution;var W=[-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,1,1,-1,1,1,1,1,-1,1,1,-1,-1];for(m=[],N=0;N<6;N++)m[N]=W.slice(12*N,12*N+12),W=[-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,1,1,-1,1,1,1,1,-1,1,1,-1,-1];var q=0;if("equirectangular"==w){if(q=c.getParameter(c.MAX_TEXTURE_SIZE),Math.max(g.width/2,g.height)>q)throw console.log("Error: The image is too big; it's "+g.width+"px wide, but this device's maximum supported size is "+2*q+"px."),{type:"webgl size error",width:g.width,maxWidth:2*q}}else if("cubemap"==w&&k>c.getParameter(c.MAX_CUBE_MAP_TEXTURE_SIZE))throw console.log("Error: The image is too big; it's "+width+"px wide, but this device's maximum supported size is "+q+"px."),{type:"webgl size error",width:width,maxWidth:q};S===a||S.horizonPitch===a&&S.horizonRoll===a||(v=[S.horizonPitch==a?0:S.horizonPitch,S.horizonRoll==a?0:S.horizonRoll]);var j=c.TEXTURE_2D;c.viewport(0,0,c.drawingBufferWidth,c.drawingBufferHeight),d=c.createShader(c.VERTEX_SHADER);var Z=n;"multires"==w&&(Z=i),c.shaderSource(d,Z),c.compileShader(d),u=c.createShader(c.FRAGMENT_SHADER);var V=l;"cubemap"==w?(j=c.TEXTURE_CUBE_MAP,V=s):"multires"==w&&(V=h),c.shaderSource(u,V),c.compileShader(u),r=c.createProgram(),c.attachShader(r,d),c.attachShader(r,u),c.linkProgram(r),c.getShaderParameter(d,c.COMPILE_STATUS)||console.log(c.getShaderInfoLog(d)),c.getShaderParameter(u,c.COMPILE_STATUS)||console.log(c.getShaderInfoLog(u)),c.getProgramParameter(r,c.LINK_STATUS)||console.log(c.getProgramInfoLog(r)),c.useProgram(r),r.drawInProgress=!1;var K=S.backgroundColor?S.backgroundColor:[0,0,0];if(c.clearColor(K[0],K[1],K[2],1),c.clear(c.COLOR_BUFFER_BIT),r.texCoordLocation=c.getAttribLocation(r,"a_texCoord"),c.enableVertexAttribArray(r.texCoordLocation),"multires"!=w){if(b||(b=c.createBuffer()),c.bindBuffer(c.ARRAY_BUFFER,b),c.bufferData(c.ARRAY_BUFFER,new Float32Array([-1,1,1,1,1,-1,-1,1,1,-1,-1,-1]),c.STATIC_DRAW),c.vertexAttribPointer(r.texCoordLocation,2,c.FLOAT,!1,0,0),r.aspectRatio=c.getUniformLocation(r,"u_aspectRatio"),c.uniform1f(r.aspectRatio,c.drawingBufferWidth/c.drawingBufferHeight),r.psi=c.getUniformLocation(r,"u_psi"),r.theta=c.getUniformLocation(r,"u_theta"),r.f=c.getUniformLocation(r,"u_f"),r.h=c.getUniformLocation(r,"u_h"),r.v=c.getUniformLocation(r,"u_v"),r.vo=c.getUniformLocation(r,"u_vo"),r.rot=c.getUniformLocation(r,"u_rot"),c.uniform1f(r.h,L/(2*Math.PI)),c.uniform1f(r.v,C/Math.PI),c.uniform1f(r.vo,I/Math.PI*2),"equirectangular"==w&&(r.backgroundColor=c.getUniformLocation(r,"u_backgroundColor"),c.uniform4fv(r.backgroundColor,K.concat([1]))),r.texture=c.createTexture(),c.bindTexture(j,r.texture),"cubemap"==w)c.texImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X,0,c.RGB,c.RGB,c.UNSIGNED_BYTE,g[1]),c.texImage2D(c.TEXTURE_CUBE_MAP_NEGATIVE_X,0,c.RGB,c.RGB,c.UNSIGNED_BYTE,g[3]),c.texImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_Y,0,c.RGB,c.RGB,c.UNSIGNED_BYTE,g[4]),c.texImage2D(c.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,c.RGB,c.RGB,c.UNSIGNED_BYTE,g[5]),c.texImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_Z,0,c.RGB,c.RGB,c.UNSIGNED_BYTE,g[0]),c.texImage2D(c.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,c.RGB,c.RGB,c.UNSIGNED_BYTE,g[2]);else if(g.width<=q)c.uniform1i(c.getUniformLocation(r,"u_splitImage"),0),c.texImage2D(j,0,c.RGB,c.RGB,c.UNSIGNED_BYTE,g);else{c.uniform1i(c.getUniformLocation(r,"u_splitImage"),1);var J=t.createElement("canvas");J.width=g.width,J.height=g.height;var Q=J.getContext("2d");Q.drawImage(g,0,0);var $=Q.getImageData(0,0,g.width/2,g.height);c.texImage2D(j,0,c.RGB,c.RGB,c.UNSIGNED_BYTE,$),r.texture2=c.createTexture(),c.activeTexture(c.TEXTURE1),c.bindTexture(j,r.texture2),c.uniform1i(c.getUniformLocation(r,"u_image1"),1),$=Q.getImageData(g.width/2,0,g.width/2,g.height),c.texImage2D(j,0,c.RGB,c.RGB,c.UNSIGNED_BYTE,$),c.texParameteri(j,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(j,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texParameteri(j,c.TEXTURE_MIN_FILTER,c.LINEAR),c.texParameteri(j,c.TEXTURE_MAG_FILTER,c.LINEAR),c.activeTexture(c.TEXTURE0)}c.texParameteri(j,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(j,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texParameteri(j,c.TEXTURE_MIN_FILTER,c.LINEAR),c.texParameteri(j,c.TEXTURE_MAG_FILTER,c.LINEAR)}else r.vertPosLocation=c.getAttribLocation(r,"a_vertCoord"),c.enableVertexAttribArray(r.vertPosLocation),x||(x=c.createBuffer()),E||(E=c.createBuffer()),M||(M=c.createBuffer()),c.bindBuffer(c.ARRAY_BUFFER,E),c.bufferData(c.ARRAY_BUFFER,new Float32Array([0,0,1,0,1,1,0,1]),c.STATIC_DRAW),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,M),c.bufferData(c.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,0,2,3]),c.STATIC_DRAW),r.perspUniform=c.getUniformLocation(r,"u_perspMatrix"),r.cubeUniform=c.getUniformLocation(r,"u_cubeMatrix"),r.level=-1,r.currentNodes=[],r.nodeCache=[],r.nodeCacheTimestamp=0;var ee=c.getError();if(0!==ee)throw console.log("Error: Something went wrong with WebGL!",ee),{type:"webgl error"};A()}},this.destroy=function(){if(o!==a&&(R!==a&&o.contains(R)&&o.removeChild(R),p!==a&&o.contains(p)&&o.removeChild(p)),c){var e=c.getExtension("WEBGL_lose_context");e&&e.loseContext()}},this.resize=function(){var t=e.devicePixelRatio||1;R.width=R.clientWidth*t,R.height=R.clientHeight*t,c&&(1286==c.getError()&&O(),c.viewport(0,0,c.drawingBufferWidth,c.drawingBufferHeight),"multires"!=w&&c.uniform1f(r.aspectRatio,R.clientWidth/R.clientHeight))},this.resize(),this.setPose=function(e,t){v=[e,t]},this.render=function(e,t,o,n){var i,s,l=0;if(n===a&&(n={}),n.roll&&(l=n.roll),v!==a){var h=v[0],d=v[1],u=e,b=t,M=Math.cos(d)*Math.sin(e)*Math.sin(h)+Math.cos(e)*(Math.cos(h)*Math.cos(t)+Math.sin(d)*Math.sin(h)*Math.sin(t)),P=-Math.sin(e)*Math.sin(d)+Math.cos(e)*Math.cos(d)*Math.sin(t),D=Math.cos(d)*Math.cos(h)*Math.sin(e)+Math.cos(e)*(-Math.cos(t)*Math.sin(h)+Math.cos(h)*Math.sin(d)*Math.sin(t));e=Math.asin(Math.max(Math.min(D,1),-1)),t=Math.atan2(P,M);var k=[Math.cos(u)*(Math.sin(d)*Math.sin(h)*Math.cos(b)-Math.cos(h)*Math.sin(b)),Math.cos(u)*Math.cos(d)*Math.cos(b),Math.cos(u)*(Math.cos(h)*Math.sin(d)*Math.cos(b)+Math.sin(b)*Math.sin(h))],O=[-Math.cos(e)*Math.sin(t),Math.cos(e)*Math.cos(t)],U=Math.acos(Math.max(Math.min((k[0]*O[0]+k[1]*O[1])/(Math.sqrt(k[0]*k[0]+k[1]*k[1]+k[2]*k[2])*Math.sqrt(O[0]*O[0]+O[1]*O[1])),1),-1));k[2]<0&&(U=2*Math.PI-U),l+=U}if(c||"multires"!=w&&"cubemap"!=w){if("multires"!=w){var F=2*Math.atan(Math.tan(.5*o)/(c.drawingBufferWidth/c.drawingBufferHeight));i=1/Math.tan(.5*F),c.uniform1f(r.psi,t),c.uniform1f(r.theta,e),c.uniform1f(r.rot,l),c.uniform1f(r.f,i),!0===y&&"equirectangular"==w&&(c.bindTexture(c.TEXTURE_2D,r.texture),c.texImage2D(c.TEXTURE_2D,0,c.RGB,c.RGB,c.UNSIGNED_BYTE,g)),c.drawArrays(c.TRIANGLES,0,6)}else{var B=(V=o,K=c.drawingBufferWidth/c.drawingBufferHeight,J=.1,Q=100,$=2*Math.atan(Math.tan(V/2)*c.drawingBufferHeight/c.drawingBufferWidth),[(ee=1/Math.tan($/2))/K,0,0,0,0,ee,0,0,0,0,(Q+J)/(J-Q),2*Q*J/(J-Q),0,0,-1,0]);!function(e){var t=1;for(;t<g.maxLevel&&c.drawingBufferWidth>g.tileResolution*Math.pow(2,t-1)*Math.tan(e/2)*.707;)t++;r.level=t}(o);var z=[1,0,0,0,1,0,0,0,1];z=I(z=I(z=I(z,-l,"z"),-e,"x"),t,"y"),z=[(Z=z)[0],Z[1],Z[2],0,Z[3],Z[4],Z[5],0,Z[6],Z[7],Z[8],0,0,0,0,1],c.uniformMatrix4fv(r.perspUniform,!1,new Float32Array(A(B))),c.uniformMatrix4fv(r.cubeUniform,!1,new Float32Array(A(z)));var H=[(q=B)[0]*(j=z)[0],q[0]*j[1],q[0]*j[2],0,q[5]*j[4],q[5]*j[5],q[5]*j[6],0,q[10]*j[8],q[10]*j[9],q[10]*j[10],q[11],-j[8],-j[9],-j[10],0];if(r.nodeCache.sort(_),r.nodeCache.length>200&&r.nodeCache.length>r.currentNodes.length+50)for(var G=r.nodeCache.splice(200,r.nodeCache.length-200),Y=0;Y<G.length;Y++)c.deleteTexture(G[Y].texture);r.currentNodes=[];var X=["f","b","u","d","l","r"];for(s=0;s<6;s++){C(H,new L(m[s],X[s],1,0,0,g.fullpath),e,t,o)}for(r.currentNodes.sort(T),Y=S.length-1;Y>=0;Y--)-1===r.currentNodes.indexOf(S[Y].node)&&(S[Y].node.textureLoad=!1,S.splice(Y,1));if(0===S.length)for(Y=0;Y<r.currentNodes.length;Y++){var W=r.currentNodes[Y];if(!W.texture&&!W.textureLoad){W.textureLoad=!0,setTimeout(N,0,W);break}}!function(){if(!r.drawInProgress){r.drawInProgress=!0,c.clear(c.COLOR_BUFFER_BIT);for(var e=0;e<r.currentNodes.length;e++)r.currentNodes[e].textureLoaded>1&&(c.bindBuffer(c.ARRAY_BUFFER,x),c.bufferData(c.ARRAY_BUFFER,new Float32Array(r.currentNodes[e].vertices),c.STATIC_DRAW),c.vertexAttribPointer(r.vertPosLocation,3,c.FLOAT,!1,0,0),c.bindBuffer(c.ARRAY_BUFFER,E),c.vertexAttribPointer(r.texCoordLocation,2,c.FLOAT,!1,0,0),c.bindTexture(c.TEXTURE_2D,r.currentNodes[e].texture),c.drawElements(c.TRIANGLES,6,c.UNSIGNED_SHORT,0));r.drawInProgress=!1}}()}var q,j,Z,V,K,J,Q,$,ee;if(n.returnImage!==a)return R.toDataURL("image/png")}else{var te={f:"translate3d(-"+((s=f/2)+2)+"px, -"+(s+2)+"px, -"+s+"px)",b:"translate3d("+(s+2)+"px, -"+(s+2)+"px, "+s+"px) rotateX(180deg) rotateZ(180deg)",u:"translate3d(-"+(s+2)+"px, -"+s+"px, "+(s+2)+"px) rotateX(270deg)",d:"translate3d(-"+(s+2)+"px, "+s+"px, -"+(s+2)+"px) rotateX(90deg)",l:"translate3d(-"+s+"px, -"+(s+2)+"px, "+(s+2)+"px) rotateX(180deg) rotateY(90deg) rotateZ(180deg)",r:"translate3d("+s+"px, -"+(s+2)+"px, -"+(s+2)+"px) rotateY(270deg)"},ae=(i=1/Math.tan(o/2))*R.clientWidth/2+"px",oe="perspective("+ae+") translateZ("+ae+") rotateX("+e+"rad) rotateY("+t+"rad) ",ne=Object.keys(te);for(Y=0;Y<6;Y++){var ie=p.querySelector(".pn-"+ne[Y]+"face");ie&&(ie.style.webkitTransform=oe+te[ne[Y]],ie.style.transform=oe+te[ne[Y]])}}},this.isLoading=function(){if(c&&"multires"==w)for(var e=0;e<r.currentNodes.length;e++)if(!r.currentNodes[e].textureLoaded)return!0;return!1},this.getCanvas=function(){return R};var S=[],D=function(){var e,t=4,a={};function o(){var o=this;this.texture=this.callback=null,this.image=new Image,this.image.crossOrigin=e||"anonymous";var n=function(){var e,n;o.image.width>0&&o.image.height>0?(e=o.image,n=o.texture,c.bindTexture(c.TEXTURE_2D,n),c.texImage2D(c.TEXTURE_2D,0,c.RGB,c.RGB,c.UNSIGNED_BYTE,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.bindTexture(c.TEXTURE_2D,null),o.callback(o.texture,!0)):o.callback(o.texture,!1),function(e){if(S.length){var o=S.shift();e.loadTexture(o.src,o.texture,o.callback)}else a[t++]=e}(o)};this.image.addEventListener("load",n),this.image.addEventListener("error",n)}o.prototype.loadTexture=function(e,t,a){this.texture=t,this.callback=a,this.image.src=e};for(var n=0;n<t;n++)a[n]=new o;return function(o,n,i,r){e=r;var s=c.createTexture();return t?a[--t].loadTexture(n,s,i):S.push(new function(e,t,a,o){this.node=e,this.src=t,this.texture=a,this.callback=o}(o,n,s,i)),s}}();function N(e){D(e,encodeURI(e.path+"."+g.extension),function(t,a){e.texture=t,e.textureLoaded=a?2:1},P.crossOrigin)}function k(e,t){var a,o,n=(o=t,[(a=e)[0]*o[0]+a[1]*o[1]+a[2]*o[2],a[4]*o[0]+a[5]*o[1]+a[6]*o[2],a[11]+a[8]*o[0]+a[9]*o[1]+a[10]*o[2],1/(a[12]*o[0]+a[13]*o[1]+a[14]*o[2])]),i=n[0]*n[3],r=n[1]*n[3],s=n[2]*n[3],l=[0,0,0];return i<-1&&(l[0]=-1),i>1&&(l[0]=1),r<-1&&(l[1]=-1),r>1&&(l[1]=1),(s<-1||s>1)&&(l[2]=1),l}function O(){console.log("Reducing canvas size due to error 1286!"),R.width=Math.round(R.width/2),R.height=Math.round(R.height/2)}}var n=["attribute vec2 a_texCoord;","varying vec2 v_texCoord;","void main() {","gl_Position = vec4(a_texCoord, 0.0, 1.0);","v_texCoord = a_texCoord;","}"].join(""),i=["attribute vec3 a_vertCoord;","attribute vec2 a_texCoord;","uniform mat4 u_cubeMatrix;","uniform mat4 u_perspMatrix;","varying mediump vec2 v_texCoord;","void main(void) {","gl_Position = u_perspMatrix * u_cubeMatrix * vec4(a_vertCoord, 1.0);","v_texCoord = a_texCoord;","}"].join(""),r=["precision mediump float;","uniform float u_aspectRatio;","uniform float u_psi;","uniform float u_theta;","uniform float u_f;","uniform float u_h;","uniform float u_v;","uniform float u_vo;","uniform float u_rot;","const float PI = 3.14159265358979323846264;","uniform sampler2D u_image0;","uniform sampler2D u_image1;","uniform bool u_splitImage;","uniform samplerCube u_imageCube;","varying vec2 v_texCoord;","uniform vec4 u_backgroundColor;","void main() {","float x = v_texCoord.x * u_aspectRatio;","float y = v_texCoord.y;","float sinrot = sin(u_rot);","float cosrot = cos(u_rot);","float rot_x = x * cosrot - y * sinrot;","float rot_y = x * sinrot + y * cosrot;","float sintheta = sin(u_theta);","float costheta = cos(u_theta);","float a = u_f * costheta - rot_y * sintheta;","float root = sqrt(rot_x * rot_x + a * a);","float lambda = atan(rot_x / root, a / root) + u_psi;","float phi = atan((rot_y * costheta + u_f * sintheta) / root);"].join("\n"),s=r+["float cosphi = cos(phi);","gl_FragColor = textureCube(u_imageCube, vec3(cosphi*sin(lambda), sin(phi), cosphi*cos(lambda)));","}"].join("\n"),l=r+["lambda = mod(lambda + PI, PI * 2.0) - PI;","vec2 coord = vec2(lambda / PI, phi / (PI / 2.0));","if(coord.x < -u_h || coord.x > u_h || coord.y < -u_v + u_vo || coord.y > u_v + u_vo)","gl_FragColor = u_backgroundColor;","else {","if(u_splitImage) {","if(coord.x < 0.0)","gl_FragColor = texture2D(u_image0, vec2((coord.x + u_h) / u_h, (-coord.y + u_v + u_vo) / (u_v * 2.0)));","else","gl_FragColor = texture2D(u_image1, vec2((coord.x + u_h) / u_h - 1.0, (-coord.y + u_v + u_vo) / (u_v * 2.0)));","} else {","gl_FragColor = texture2D(u_image0, vec2((coord.x + u_h) / (u_h * 2.0), (-coord.y + u_v + u_vo) / (u_v * 2.0)));","}","}","}"].join("\n"),h=["varying mediump vec2 v_texCoord;","uniform sampler2D u_sampler;","void main(void) {","gl_FragColor = texture2D(u_sampler, v_texCoord);","}"].join("");return{renderer:function(e,t,a,n){return new o(e,t,a,n)}}}(window,document),window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)}),window.pn=function(e,t,a){"use strict";function o(o,n){var i,r,s,l,h,c,d,u,f,p=this,m=!1,v=Date.now(),g=0,w=0,y=-1,b=0,x=0,E=new Array(10),M=!1,P=!1,R=!1,_={yaw:0,pitch:0,hfov:0},T=!1,L=!1,C=0,I=0,A={},S={},D=[],N=!1,k=1e-6,O=!1,U={hfov:100,minHfov:50,multiResMinHfov:!1,maxHfov:120,pitch:0,minPitch:a,maxPitch:a,yaw:0,minYaw:-180,maxYaw:180,roll:0,haov:360,vaov:180,vOffset:0,autoRotate:!1,autoRotateInactivityDelay:-1,autoRotateStopDelay:a,type:"equirectangular",northOffset:0,showFullscreenCtrl:!0,dynamic:!1,dynamicUpdate:!1,doubleClickZoom:!0,keyboardZoom:!0,mouseZoom:!0,showZoomCtrl:!0,autoLoad:!1,showControls:!0,orientationOnByDefault:!1,hotSpotDebug:!1,backgroundColor:[0,0,0],avoidShowingBackground:!1,animationTimingFunction:function(e){return e<.5?2*e*e:(4-2*e)*e-1},draggable:!0,disableKeyboardCtrl:!1,crossOrigin:"anonymous",touchPanSpeedCoeffFactor:1,capturedKeyNumbers:[16,17,27,37,38,39,40,61,65,68,83,87,107,109,173,187,189],friction:.15,strings:{loadButtonLabel:"Click to<br>Load<br>Panorama",loadingLabel:"Loading...",bylineLabel:"by %s",noPanoramaError:"No panorama image was specified.",fileAccessError:"The file %s could not be accessed.",malformedURLError:"There is something wrong with the panorama URL.",iOS8WebGLError:"Due to iOS 8's broken WebGL implementation, only progressive encoded JPEGs work for your device (this panorama uses standard encoding).",genericWebGLError:"Your browser does not have the necessary WebGL support to display this panorama.",textureSizeError:"This panorama is too big for your device! It's %spx wide, but your device only supports images up to %spx wide. Try another device. (If you're the author, try scaling down the image.)",unknownError:"Unknown error. Check developer console."}};(o="string"==typeof o?t.getElementById(o):o).classList.add("pn-container"),o.tabIndex=0;var F=t.createElement("div");F.className="pn-ui",o.appendChild(F);var B=t.createElement("div");B.className="pn-render-container",o.appendChild(B);var z=t.createElement("div");z.className="pn-dragfix",F.appendChild(z);var H=t.createElement("span");H.className="pn-about-msg",F.appendChild(H),z.addEventListener("contextmenu",function e(t){var a=Q(t);H.style.left=a.x+"px";H.style.top=a.y+"px";clearTimeout(e.t1);clearTimeout(e.t2);H.style.display="block";H.style.opacity=1;e.t1=setTimeout(function(){H.style.opacity=0},2e3);e.t2=setTimeout(function(){H.style.display="none"},2500);t.preventDefault()});var G={},Y=t.createElement("div");Y.className="pn-sprite pn-hot-spot-debug-indicator",F.appendChild(Y),G.container=t.createElement("div"),G.container.className="pn-panorama-info",G.title=t.createElement("div"),G.title.className="pn-title-box",G.container.appendChild(G.title),G.author=t.createElement("div"),G.author.className="pn-author-box",G.container.appendChild(G.author),F.appendChild(G.container),G.load={},G.load.box=t.createElement("div"),G.load.box.className="pn-load-box",G.load.boxp=t.createElement("p"),G.load.box.appendChild(G.load.boxp),G.load.lbox=t.createElement("div"),G.load.lbox.className="pn-lbox",G.load.lbox.innerHTML='<div class="pn-loading"></div>',G.load.box.appendChild(G.load.lbox),G.load.lbar=t.createElement("div"),G.load.lbar.className="pn-lbar",G.load.lbarFill=t.createElement("div"),G.load.lbarFill.className="pn-lbar-fill",G.load.lbar.appendChild(G.load.lbarFill),G.load.box.appendChild(G.load.lbar),G.load.msg=t.createElement("p"),G.load.msg.className="pn-lmsg",G.load.box.appendChild(G.load.msg),F.appendChild(G.load.box),G.errorMsg=t.createElement("div"),G.errorMsg.className="pn-error-msg pn-info-box",F.appendChild(G.errorMsg);var X={};X.container=t.createElement("div"),X.container.className="pn-controls-container",F.appendChild(X.container),X.load=t.createElement("div"),X.load.className="pn-load-button",X.load.addEventListener("click",function(){Ce(),ke()}),F.appendChild(X.load),X.zoom=t.createElement("div"),X.zoom.className="pn-zoom-controls pn-controls",X.zoomIn=t.createElement("div"),X.zoomIn.className="pn-zoom-in pn-sprite pn-control",X.zoomIn.addEventListener("click",function(){l&&(De(i.hfov-5),ye())}),X.zoom.appendChild(X.zoomIn),X.zoomOut=t.createElement("div"),X.zoomOut.className="pn-zoom-out pn-sprite pn-control",X.zoomOut.addEventListener("click",function(){l&&(De(i.hfov+5),ye())}),X.zoom.appendChild(X.zoomOut),X.container.appendChild(X.zoom),X.fullscreen=t.createElement("div"),X.fullscreen.addEventListener("click",Ie),X.fullscreen.className="pn-fullscreen-toggle-button pn-sprite pn-fullscreen-toggle-button-inactive pn-controls pn-control",(t.fullscreenEnabled||t.mozFullScreenEnabled||t.webkitFullscreenEnabled||t.msFullscreenEnabled)&&X.container.appendChild(X.fullscreen),X.orientation=t.createElement("div"),X.orientation.addEventListener("click",function(e){L?Ue():Fe()}),X.orientation.addEventListener("mousedown",function(e){e.stopPropagation()}),X.orientation.addEventListener("touchstart",function(e){e.stopPropagation()}),X.orientation.addEventListener("pointerdown",function(e){e.stopPropagation()}),X.orientation.className="pn-orientation-button pn-orientation-button-inactive pn-sprite pn-controls pn-control";var W,q=!1;e.DeviceOrientationEvent?e.addEventListener("deviceorientation",function t(a){e.removeEventListener("deviceorientation",t),a&&null!==a.alpha&&null!==a.beta&&null!==a.gamma?(X.container.appendChild(X.orientation),W=!0,q&&Fe()):W=!1}):W=!1;var j=t.createElement("div");function Z(){var o=t.createElement("div");if(o.innerHTML="\x3c!--[if lte IE 9]><i></i><![endif]--\x3e",1!=o.getElementsByTagName("i").length){var n,r;if(u=i.hfov,f=i.pitch,"cubemap"==i.type){for(h=[],n=0;n<6;n++)h.push(new Image),h[n].crossOrigin=i.crossOrigin;G.load.lbox.style.display="block",G.load.lbar.style.display="none"}else if("multires"==i.type){var s=JSON.parse(JSON.stringify(i.multiRes));i.basePath&&i.multiRes.basePath&&!/^(?:[a-z]+:)?\/\//i.test(i.multiRes.basePath)?s.basePath=i.basePath+i.multiRes.basePath:i.multiRes.basePath?s.basePath=i.multiRes.basePath:i.basePath&&(s.basePath=i.basePath),h=s}else if(!0===i.dynamic)h=i.panorama;else{if(i.panorama===a)return void J(i.strings.noPanoramaError);h=new Image}if("cubemap"==i.type){var l=6,c=function(){0===--l&&K()},d=function(e){var a=t.createElement("a");a.href=e.target.src,a.textContent=a.href,J(i.strings.fileAccessError.replace("%s",a.outerHTML))};for(n=0;n<h.length;n++)"null"==(r=i.cubeMap[n])?(console.log("Will use background instead of missing cubemap face "+n),c()):(i.basePath&&!V(r)&&(r=i.basePath+r),h[n].onload=c,h[n].onerror=d,h[n].src=ze(r))}else if("multires"==i.type)K();else if(r="",i.basePath&&(r=i.basePath),!0!==i.dynamic){r=V(i.panorama)?i.panorama:r+i.panorama,h.onload=function(){e.URL.revokeObjectURL(this.src),K()};var p=new XMLHttpRequest;p.onloadend=function(){if(200!=p.status){var o=t.createElement("a");o.href=r,o.textContent=o.href,J(i.strings.fileAccessError.replace("%s",o.outerHTML))}var n,s,l=this.response;n=l,(s=new FileReader).addEventListener("loadend",function(){var t=s.result;if(navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 8_/)){var o=t.indexOf("ÿÂ");(o<0||o>65536)&&J(i.strings.iOS8WebGLError)}var r=t.indexOf("<x:xmpmeta");if(r>-1&&!0!==i.ignoreGPanoXMP){var l=t.substring(r,t.indexOf("</x:xmpmeta>")+12),c=function(e){var t;return l.indexOf(e+'="')>=0?t=(t=l.substring(l.indexOf(e+'="')+e.length+2)).substring(0,t.indexOf('"')):l.indexOf(e+">")>=0&&(t=(t=l.substring(l.indexOf(e+">")+e.length+1)).substring(0,t.indexOf("<"))),t!==a?Number(t):null},d={fullWidth:c("GPano:FullPanoWidthPixels"),croppedWidth:c("GPano:CroppedAreaImageWidthPixels"),fullHeight:c("GPano:FullPanoHeightPixels"),croppedHeight:c("GPano:CroppedAreaImageHeightPixels"),topPixels:c("GPano:CroppedAreaTopPixels"),heading:c("GPano:PoseHeadingDegrees"),horizonPitch:c("GPano:PosePitchDegrees"),horizonRoll:c("GPano:PoseRollDegrees")};null!==d.fullWidth&&null!==d.croppedWidth&&null!==d.fullHeight&&null!==d.croppedHeight&&null!==d.topPixels&&(D.indexOf("haov")<0&&(i.haov=d.croppedWidth/d.fullWidth*360),D.indexOf("vaov")<0&&(i.vaov=d.croppedHeight/d.fullHeight*180),D.indexOf("vOffset")<0&&(i.vOffset=-180*((d.topPixels+d.croppedHeight/2)/d.fullHeight-.5)),null!==d.heading&&D.indexOf("northOffset")<0&&(i.northOffset=d.heading,!1!==i.compass&&(i.compass=!0)),null!==d.horizonPitch&&null!==d.horizonRoll&&(D.indexOf("horizonPitch")<0&&(i.horizonPitch=d.horizonPitch),D.indexOf("horizonRoll")<0&&(i.horizonRoll=d.horizonRoll)))}h.src=e.URL.createObjectURL(n)}),s.readAsBinaryString!==a?s.readAsBinaryString(n):s.readAsText(n),G.load.msg.innerHTML=""},p.onprogress=function(e){if(e.lengthComputable){var t,a,o,n=e.loaded/e.total*100;G.load.lbarFill.style.width=n+"%",e.total>1e6?(t="MB",a=(e.loaded/1e6).toFixed(2),o=(e.total/1e6).toFixed(2)):e.total>1e3?(t="kB",a=(e.loaded/1e3).toFixed(1),o=(e.total/1e3).toFixed(1)):(t="B",a=e.loaded,o=e.total),G.load.msg.innerHTML=a+" / "+o+" "+t}else G.load.lbox.style.display="block",G.load.lbar.style.display="none"};try{p.open("GET",r,!0)}catch(e){J(i.strings.malformedURLError)}p.responseType="blob",p.setRequestHeader("Accept","image/*,*/*;q=0.9"),p.withCredentials="use-credentials"===i.crossOrigin,p.send()}i.draggable&&F.classList.add("pn-grab"),F.classList.remove("pn-grabbing")}else J()}function V(e){return new RegExp("^(?:[a-z]+:)?//","i").test(e)||"/"==e[0]||"blob:"==e.slice(0,5)}function K(){r||(r=new libpn.renderer(B)),R||(R=!0,z.addEventListener("mousedown",$,!1),t.addEventListener("mousemove",ae,!1),t.addEventListener("mouseup",oe,!1),i.mouseZoom&&(F.addEventListener("mousewheel",ue,!1),F.addEventListener("DOMMouseScroll",ue,!1)),i.doubleClickZoom&&z.addEventListener("dblclick",ee,!1),F.addEventListener("mozfullscreenchange",Ae,!1),F.addEventListener("webkitfullscreenchange",Ae,!1),F.addEventListener("msfullscreenchange",Ae,!1),F.addEventListener("fullscreenchange",Ae,!1),e.addEventListener("resize",we,!1),e.addEventListener("orientationchange",we,!1),i.disableKeyboardCtrl||(o.addEventListener("keydown",fe,!1),o.addEventListener("keyup",me,!1),o.addEventListener("blur",pe,!1)),t.addEventListener("mouseleave",oe,!1),""===t.documentElement.style.pointerAction&&""===t.documentElement.style.touchAction?(z.addEventListener("pointerdown",he,!1),z.addEventListener("pointermove",ce,!1),z.addEventListener("pointerup",de,!1),z.addEventListener("pointerleave",de,!1)):(z.addEventListener("touchstart",ne,!1),z.addEventListener("touchmove",ie,!1),z.addEventListener("touchend",re,!1)),e.navigator.pointerEnabled&&(o.style.touchAction="none")),function(){try{var e={};i.horizonPitch!==a&&(e.horizonPitch=i.horizonPitch*Math.PI/180),i.horizonRoll!==a&&(e.horizonRoll=i.horizonRoll*Math.PI/180),i.backgroundColor!==a&&(e.backgroundColor=i.backgroundColor),r.init(h,i.type,i.dynamic,i.haov*Math.PI/180,i.vaov*Math.PI/180,i.vOffset*Math.PI/180,Pe,e),!0!==i.dynamic&&(h=a)}catch(e){if("webgl error"==e.type||"no webgl"==e.type)J();else{if("webgl size error"!=e.type)throw J(i.strings.unknownError),e;J(i.strings.textureSizeError.replace("%s",e.width).replace("%s",e.maxWidth))}}}(),De(i.hfov),setTimeout(function(){!0},500)}function J(e){e===a&&(e=i.strings.genericWebGLError),G.errorMsg.innerHTML="<p>"+e+"</p>",X.load.style.display="none",G.load.box.style.display="none",G.errorMsg.style.display="table",P=!0,B.style.display="none",He("error",e)}function Q(e){var t=o.getBoundingClientRect(),a={};return a.x=(e.clientX||e.pageX)-t.left,a.y=(e.clientY||e.pageY)-t.top,a}function $(e){if(e.preventDefault(),o.focus(),l&&i.draggable){var t=Q(e);if(i.hotSpotDebug){var a=te(e);console.log("Pitch: "+a[0]+", Yaw: "+a[1]+", Center Pitch: "+i.pitch+", Center Yaw: "+i.yaw+", HFOV: "+i.hfov)}Ne(),Ue(),i.roll=0,_.hfov=0,m=!0,v=Date.now(),g=t.x,w=t.y,b=i.yaw,x=i.pitch,F.classList.add("pn-grabbing"),F.classList.remove("pn-grab"),He("mousedown",e),ye()}}function ee(e){if(i.minHfov===i.hfov)p.setHfov(u,1e3);else{var t=te(e);p.lookAt(t[0],t[1],i.minHfov,1e3)}}function te(e){var t=Q(e),a=r.getCanvas(),o=a.clientWidth,n=a.clientHeight,s=t.x/o*2-1,l=(1-t.y/n*2)*n/o,h=1/Math.tan(i.hfov*Math.PI/360),c=Math.sin(i.pitch*Math.PI/180),d=Math.cos(i.pitch*Math.PI/180),u=h*d-l*c,f=Math.sqrt(s*s+u*u),p=180*Math.atan((l*d+h*c)/f)/Math.PI,m=180*Math.atan2(s/f,u/f)/Math.PI+i.yaw;return m<-180&&(m+=360),m>180&&(m-=360),[p,m]}function ae(e){if(m&&l){v=Date.now();var t=r.getCanvas(),a=t.clientWidth,o=t.clientHeight,n=Q(e),s=180*(Math.atan(g/a*2-1)-Math.atan(n.x/a*2-1))/Math.PI*i.hfov/90+b;_.yaw=(s-i.yaw)%360*.2,i.yaw=s;var h=2*Math.atan(Math.tan(i.hfov/360*Math.PI)*o/a)*180/Math.PI,c=180*(Math.atan(n.y/o*2-1)-Math.atan(w/o*2-1))/Math.PI*h/90+x;_.pitch=.2*(c-i.pitch),i.pitch=c}}function oe(e){m&&(m=!1,Date.now()-v>15&&(_.pitch=_.yaw=0),F.classList.add("pn-grab"),F.classList.remove("pn-grabbing"),v=Date.now(),He("mouseup",e))}function ne(e){if(l&&i.draggable){Ne(),Ue(),i.roll=0,_.hfov=0;var t=Q(e.targetTouches[0]);if(g=t.x,w=t.y,2==e.targetTouches.length){var a=Q(e.targetTouches[1]);g+=.5*(a.x-t.x),w+=.5*(a.y-t.y),y=Math.sqrt((t.x-a.x)*(t.x-a.x)+(t.y-a.y)*(t.y-a.y))}m=!0,v=Date.now(),b=i.yaw,x=i.pitch,He("touchstart",e),ye()}}function ie(e){if(i.draggable&&(e.preventDefault(),l&&(v=Date.now()),m&&l)){var t=Q(e.targetTouches[0]),a=t.x,o=t.y;if(2==e.targetTouches.length&&-1!=y){var n=Q(e.targetTouches[1]);a+=.5*(n.x-t.x),o+=.5*(n.y-t.y);var r=Math.sqrt((t.x-n.x)*(t.x-n.x)+(t.y-n.y)*(t.y-n.y));De(i.hfov+.1*(y-r)),y=r}var s=i.hfov/360*i.touchPanSpeedCoeffFactor,h=(g-a)*s+b;_.yaw=(h-i.yaw)%360*.2,i.yaw=h;var c=(o-w)*s+x;_.pitch=.2*(c-i.pitch),i.pitch=c}}function re(){m=!1,Date.now()-v>150&&(_.pitch=_.yaw=0),y=-1,v=Date.now(),He("touchend",event)}j.className="pn-compass pn-controls pn-control",F.appendChild(j),n.firstScene?Le(n.firstScene):n.default&&n.default.firstScene?Le(n.default.firstScene):Le(null),Ce(!0);var se=[],le=[];function he(e){"touch"==e.pointerType&&(se.push(e.pointerId),le.push({clientX:e.clientX,clientY:e.clientY}),e.targetTouches=le,ne(e),e.preventDefault())}function ce(e){if("touch"==e.pointerType)for(var t=0;t<se.length;t++)if(e.pointerId==se[t])return le[t].clientX=e.clientX,le[t].clientY=e.clientY,e.targetTouches=le,ie(e),void e.preventDefault()}function de(e){if("touch"==e.pointerType){for(var t=!1,o=0;o<se.length;o++)e.pointerId==se[o]&&(se[o]=a),se[o]&&(t=!0);t||(se=[],le=[],re()),e.preventDefault()}}function ue(e){l&&("fullscreenonly"!=i.mouseZoom||M)&&(e.preventDefault(),Ne(),v=Date.now(),e.wheelDeltaY?(De(i.hfov-.05*e.wheelDeltaY),_.hfov=e.wheelDelta<0?1:-1):e.wheelDelta?(De(i.hfov-.05*e.wheelDelta),_.hfov=e.wheelDelta<0?1:-1):e.detail&&(De(i.hfov+1.5*e.detail),_.hfov=e.detail>0?1:-1),ye())}function fe(e){Ne(),v=Date.now(),Ue(),i.roll=0;var t=e.which||e.keycode;i.capturedKeyNumbers.indexOf(t)<0||(e.preventDefault(),27==t?M&&Ie():ve(t,!0))}function pe(){for(var e=0;e<10;e++)E[e]=!1}function me(e){var t=e.which||e.keycode;i.capturedKeyNumbers.indexOf(t)<0||(e.preventDefault(),ve(t,!1))}function ve(e,t){var a=!1;switch(e){case 109:case 189:case 17:case 173:E[0]!=t&&(a=!0),E[0]=t;break;case 107:case 187:case 16:case 61:E[1]!=t&&(a=!0),E[1]=t;break;case 38:E[2]!=t&&(a=!0),E[2]=t;break;case 87:E[6]!=t&&(a=!0),E[6]=t;break;case 40:E[3]!=t&&(a=!0),E[3]=t;break;case 83:E[7]!=t&&(a=!0),E[7]=t;break;case 37:E[4]!=t&&(a=!0),E[4]=t;break;case 65:E[8]!=t&&(a=!0),E[8]=t;break;case 39:E[5]!=t&&(a=!0),E[5]=t;break;case 68:E[9]!=t&&(a=!0),E[9]=t}a&&t&&(c="undefined"!=typeof performance&&performance.now()?performance.now():Date.now(),ye())}function ge(e){var t=A[e],a=Math.min(1,Math.max((Date.now()-t.startTime)/1e3/(t.duration/1e3),0)),o=t.startPosition+i.animationTimingFunction(a)*(t.endPosition-t.startPosition);(t.endPosition>t.startPosition&&o>=t.endPosition||t.endPosition<t.startPosition&&o<=t.endPosition||t.endPosition===t.startPosition)&&(o=t.endPosition,_[e]=0,delete A[e]),i[e]=o}function we(){Ae()}function ye(){T||(T=!0,be())}function be(){if(function(){var e;if(l){i.yaw>180?i.yaw-=360:i.yaw<-180&&(i.yaw+=360),e=i.yaw;var t=0;if(i.avoidShowingBackground){var o=r.getCanvas(),n=i.hfov/2,s=180*Math.atan2(Math.tan(n/180*Math.PI),o.width/o.height)/Math.PI,h=i.vaov>i.haov;h?s*(1-Math.min(Math.cos((i.pitch-n)/180*Math.PI),Math.cos((i.pitch+n)/180*Math.PI))):t=n*(1-Math.min(Math.cos((i.pitch-s)/180*Math.PI),Math.cos((i.pitch+s)/180*Math.PI)))}var d=i.maxYaw-i.minYaw,u=-180,f=180;d<360&&(u=i.minYaw+i.hfov/2+t,f=i.maxYaw-i.hfov/2-t,d<i.hfov&&(u=f=(u+f)/2),i.yaw=Math.max(u,Math.min(f,i.yaw))),!1!==i.autoRotate&&e!=i.yaw&&c!==a&&(i.autoRotate*=-1);var o=r.getCanvas(),p=2*Math.atan(Math.tan(i.hfov/180*Math.PI*.5)/(o.width/o.height))/Math.PI*180,m=i.minPitch+p/2,v=i.maxPitch-p/2,g=i.maxPitch-i.minPitch;g<p&&(m=v=(m+v)/2),isNaN(m)&&(m=-90),isNaN(v)&&(v=90),i.pitch=Math.max(m,Math.min(v,i.pitch)),r.render(i.pitch*Math.PI/180,i.yaw*Math.PI/180,i.hfov*Math.PI/180,{roll:i.roll*Math.PI/180}),Te(),i.compass&&(j.style.transform="rotate("+(-i.yaw-i.northOffset)+"deg)",j.style.webkitTransform="rotate("+(-i.yaw-i.northOffset)+"deg)")}}(),d&&clearTimeout(d),m||!0===L)requestAnimationFrame(be);else if(E[0]||E[1]||E[2]||E[3]||E[4]||E[5]||E[6]||E[7]||E[8]||E[9]||i.autoRotate||A.pitch||A.yaw||A.hfov||Math.abs(_.yaw)>.01||Math.abs(_.pitch)>.01||Math.abs(_.hfov)>.01)!function(){if(l){var e,t=!1,o=i.pitch,n=i.yaw,r=i.hfov;e="undefined"!=typeof performance&&performance.now()?performance.now():Date.now(),c===a&&(c=e);var s=(e-c)*i.hfov/1700;if(s=Math.min(s,1),E[0]&&!0===i.keyboardZoom&&(De(i.hfov+(.8*_.hfov+.5)*s),t=!0),E[1]&&!0===i.keyboardZoom&&(De(i.hfov+(.8*_.hfov-.2)*s),t=!0),(E[2]||E[6])&&(i.pitch+=(.8*_.pitch+.2)*s,t=!0),(E[3]||E[7])&&(i.pitch+=(.8*_.pitch-.2)*s,t=!0),(E[4]||E[8])&&(i.yaw+=(.8*_.yaw-.2)*s,t=!0),(E[5]||E[9])&&(i.yaw+=(.8*_.yaw+.2)*s,t=!0),t&&(v=Date.now()),Date.now(),i.autoRotate){if(e-c>.001){var h=(e-c)/1e3,d=(_.yaw/h*s-.2*i.autoRotate)*h;d=(-i.autoRotate>0?1:-1)*Math.min(Math.abs(i.autoRotate*h),Math.abs(d)),i.yaw+=d}i.autoRotateStopDelay&&(i.autoRotateStopDelay-=e-c,i.autoRotateStopDelay<=0&&(i.autoRotateStopDelay=!1,I=i.autoRotate,i.autoRotate=0))}if(A.pitch&&(ge("pitch"),o=i.pitch),A.yaw&&(ge("yaw"),n=i.yaw),A.hfov&&(ge("hfov"),r=i.hfov),s>0&&!i.autoRotate){var u=1-i.friction;E[4]||E[5]||E[8]||E[9]||A.yaw||(i.yaw+=_.yaw*s*u),E[2]||E[3]||E[6]||E[7]||A.pitch||(i.pitch+=_.pitch*s*u),E[0]||E[1]||A.hfov||De(i.hfov+_.hfov*s*u)}if(c=e,s>0){_.yaw=.8*_.yaw+(i.yaw-n)/s*.2,_.pitch=.8*_.pitch+(i.pitch-o)/s*.2,_.hfov=.8*_.hfov+(i.hfov-r)/s*.2;var f=i.autoRotate?Math.abs(i.autoRotate):5;_.yaw=Math.min(f,Math.max(_.yaw,-f)),_.pitch=Math.min(f,Math.max(_.pitch,-f)),_.hfov=Math.min(f,Math.max(_.hfov,-f))}E[0]&&E[1]&&(_.hfov=0),(E[2]||E[6])&&(E[3]||E[7])&&(_.pitch=0),(E[4]||E[8])&&(E[5]||E[9])&&(_.yaw=0)}}(),i.autoRotateInactivityDelay>=0&&I&&Date.now()-v>i.autoRotateInactivityDelay&&!i.autoRotate&&(i.autoRotate=I,p.lookAt(f,a,u,3e3)),requestAnimationFrame(be);else if(r&&(r.isLoading()||!0===i.dynamic&&N))requestAnimationFrame(be);else{He("animatefinished",{pitch:p.getPitch(),yaw:p.getYaw(),hfov:p.getHfov()}),T=!1,c=a;var e=i.autoRotateInactivityDelay-(Date.now()-v);e>0?d=setTimeout(function(){i.autoRotate=I,p.lookAt(f,a,u,3e3),ye()},e):i.autoRotateInactivityDelay>=0&&I&&(i.autoRotate=I,p.lookAt(f,a,u,3e3),ye())}}function xe(e,t,a,o){this.w=e,this.x=t,this.y=a,this.z=o}function Ee(t,a,o){var n,i,r,s,l,h,c=(n=t,r=o,s=[(i=a)?i*Math.PI/180/2:0,r?r*Math.PI/180/2:0,n?n*Math.PI/180/2:0],l=[Math.cos(s[0]),Math.cos(s[1]),Math.cos(s[2])],h=[Math.sin(s[0]),Math.sin(s[1]),Math.sin(s[2])],new xe(l[0]*l[1]*l[2]-h[0]*h[1]*h[2],h[0]*l[1]*l[2]-l[0]*h[1]*h[2],l[0]*h[1]*l[2]+h[0]*l[1]*h[2],l[0]*l[1]*h[2]+h[0]*h[1]*l[2]));c=c.multiply(new xe(Math.sqrt(.5),-Math.sqrt(.5),0,0));var d=e.orientation?-e.orientation*Math.PI/180/2:0;return c.multiply(new xe(Math.cos(d),0,-Math.sin(d),0))}function Me(e){var t=Ee(e.alpha,e.beta,e.gamma).toEulerAngles();"number"==typeof L&&L<10?L+=1:10===L?(C=t[2]/Math.PI*180+i.yaw,L=!0,requestAnimationFrame(be)):(i.pitch=t[0]/Math.PI*180,i.roll=-t[1]/Math.PI*180,i.yaw=-t[2]/Math.PI*180+C)}function Pe(){if(i.sceneFadeDuration&&r.fadeImg!==a){r.fadeImg.style.opacity=0;var e=r.fadeImg;delete r.fadeImg,setTimeout(function(){B.removeChild(e),He("scenechangefadedone")},i.sceneFadeDuration)}i.compass?j.style.display="inline":j.style.display="none",function(){if(O)return;i.hotSpots?(i.hotSpots=i.hotSpots.sort(function(e,t){return e.pitch<t.pitch}),i.hotSpots.forEach(Re)):i.hotSpots=[];O=!0,Te()}(),G.load.box.style.display="none",s!==a&&(B.removeChild(s),s=a),l=!0,He("load"),ye()}function Re(e){e.pitch=Number(e.pitch)||0,e.yaw=Number(e.yaw)||0;var a=t.createElement("div");a.className="pn-hotspot-base",e.cssClass?a.className+=" "+e.cssClass:a.className+=" pn-hotspot pn-sprite pn-"+Be(e.type);var o,n=t.createElement("span");if(e.text&&(n.innerHTML=Be(e.text)),e.video){var r=t.createElement("video"),s=e.video;i.basePath&&!V(s)&&(s=i.basePath+s),r.src=ze(s),r.controls=!0,r.style.width=e.width+"px",B.appendChild(a),n.appendChild(r)}else if(e.image){s=e.image;i.basePath&&!V(s)&&(s=i.basePath+s),(o=t.createElement("a")).href=ze(e.URL?e.URL:s),o.target="_blank",n.appendChild(o);var l=t.createElement("img");l.src=ze(s),l.style.width=e.width+"px",l.style.paddingTop="5px",B.appendChild(a),o.appendChild(l),n.style.maxWidth="initial"}else if(e.URL){if((o=t.createElement("a")).href=ze(e.URL),e.attributes)for(var h in e.attributes)o.setAttribute(h,e.attributes[h]);else o.target="_blank";B.appendChild(o),a.className+=" pn-pointer",n.className+=" pn-pointer",o.appendChild(a)}else e.sceneId&&(a.onclick=a.ontouchend=function(){return a.clicked||(a.clicked=!0,Oe(e.sceneId,e.targetPitch,e.targetYaw,e.targetHfov)),!1},a.className+=" pn-pointer",n.className+=" pn-pointer"),B.appendChild(a);e.createTooltipFunc?e.createTooltipFunc(a,e.createTooltipArgs):(e.text||e.video||e.image)&&(a.classList.add("pn-tooltip"),a.appendChild(n),n.style.width=n.scrollWidth-20+"px",n.style.marginLeft=-(n.scrollWidth-a.offsetWidth)/2+"px",n.style.marginTop=-n.scrollHeight-12+"px"),e.clickHandlerFunc&&(a.addEventListener("click",function(t){e.clickHandlerFunc(t,e.clickHandlerArgs)},"false"),a.className+=" pn-pointer",n.className+=" pn-pointer"),e.div=a}function _e(e){var t=Math.sin(e.pitch*Math.PI/180),a=Math.cos(e.pitch*Math.PI/180),o=Math.sin(i.pitch*Math.PI/180),n=Math.cos(i.pitch*Math.PI/180),s=Math.cos((-e.yaw+i.yaw)*Math.PI/180),l=t*o+a*s*n;if(e.yaw<=90&&e.yaw>-90&&l<=0||(e.yaw>90||e.yaw<=-90)&&l<=0)e.div.style.visibility="hidden";else{var h=Math.sin((-e.yaw+i.yaw)*Math.PI/180),c=Math.tan(i.hfov*Math.PI/360);e.div.style.visibility="visible";var d=r.getCanvas(),u=d.clientWidth,f=d.clientHeight,p=[-u/c*h*a/l/2,-u/c*(t*n-a*s*o)/l/2],m=Math.sin(i.roll*Math.PI/180),v=Math.cos(i.roll*Math.PI/180);(p=[p[0]*v-p[1]*m,p[0]*m+p[1]*v])[0]+=(u-e.div.offsetWidth)/2,p[1]+=(f-e.div.offsetHeight)/2;var g="translate("+p[0]+"px, "+p[1]+"px) translateZ(9999px) rotate("+i.roll+"deg)";e.div.style.webkitTransform=g,e.div.style.MozTransform=g,e.div.style.transform=g}}function Te(){i.hotSpots.forEach(_e)}function Le(e){var t,a;i={};var o=["haov","vaov","vOffset","northOffset","horizonPitch","horizonRoll"];D=[];for(t in U)U.hasOwnProperty(t)&&(i[t]=U[t]);for(t in n.default)if(n.default.hasOwnProperty(t))if("strings"==t)for(a in n.default.strings)n.default.strings.hasOwnProperty(a)&&(i.strings[a]=Be(n.default.strings[a]));else i[t]=n.default[t],o.indexOf(t)>=0&&D.push(t);if(null!==e&&""!==e&&n.scenes&&n.scenes[e]){var r=n.scenes[e];for(t in r)if(r.hasOwnProperty(t))if("strings"==t)for(a in r.strings)r.strings.hasOwnProperty(a)&&(i.strings[a]=Be(r.strings[a]));else i[t]=r[t],o.indexOf(t)>=0&&D.push(t);i.scene=e}for(t in n)if(n.hasOwnProperty(t))if("strings"==t)for(a in n.strings)n.strings.hasOwnProperty(a)&&(i.strings[a]=Be(n.strings[a]));else i[t]=n[t],o.indexOf(t)>=0&&D.push(t)}function Ce(e){if((e=e||!1)&&"preview"in i){var o=i.preview;i.basePath&&!V(o)&&(o=i.basePath+o),(s=t.createElement("div")).className="pn-preview-img",s.style.backgroundImage="url('"+ze(o).replace(/"/g,"%22").replace(/'/g,"%27")+"')",B.appendChild(s)}var n=i.title,l=i.author;e&&("previewTitle"in i&&(i.title=i.previewTitle),"previewAuthor"in i&&(i.author=i.previewAuthor)),i.hasOwnProperty("title")||(G.title.innerHTML=""),i.hasOwnProperty("author")||(G.author.innerHTML=""),i.hasOwnProperty("title")||i.hasOwnProperty("author")||(G.container.style.display="none"),X.load.innerHTML="<p>"+i.strings.loadButtonLabel+"</p>",G.load.boxp.innerHTML=i.strings.loadingLabel;for(var h in i)if(i.hasOwnProperty(h))switch(h){case"title":G.title.innerHTML=Be(i[h]),G.container.style.display="inline";break;case"author":G.author.innerHTML=i.strings.bylineLabel.replace("%s",Be(i[h])),G.container.style.display="inline";break;case"fallback":var c=t.createElement("a");c.href=ze(i[h]),c.target="_blank",c.textContent="Click here to view this panorama in an alternative viewer.";var d=t.createElement("p");d.textContent="Your browser does not support WebGL.",d.appendChild(t.createElement("br")),d.appendChild(c),G.errorMsg.innerHTML="",G.errorMsg.appendChild(d);break;case"hfov":De(Number(i[h]));break;case"autoLoad":!0===i[h]&&r===a&&(G.load.box.style.display="inline",X.load.style.display="none",Z());break;case"showZoomCtrl":i[h]&&0!=i.showControls?X.zoom.style.display="block":X.zoom.style.display="none";break;case"showFullscreenCtrl":i[h]&&0!=i.showControls&&("fullscreen"in t||"mozFullScreen"in t||"webkitIsFullScreen"in t||"msFullscreenElement"in t)?X.fullscreen.style.display="block":X.fullscreen.style.display="none";break;case"hotSpotDebug":i[h]?Y.style.display="block":Y.style.display="none";break;case"showControls":i[h]||(X.orientation.style.display="none",X.zoom.style.display="none",X.fullscreen.style.display="none");break;case"orientationOnByDefault":i[h]&&(W===a?q=!0:!0===W&&Fe())}e&&(n?i.title=n:delete i.title,l?i.author=l:delete i.author)}function Ie(){if(l&&!P)if(M)t.exitFullscreen?t.exitFullscreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.webkitCancelFullScreen?t.webkitCancelFullScreen():t.msExitFullscreen&&t.msExitFullscreen();else try{o.requestFullscreen?o.requestFullscreen():o.mozRequestFullScreen?o.mozRequestFullScreen():o.msRequestFullscreen?o.msRequestFullscreen():o.webkitRequestFullScreen()}catch(e){}}function Ae(){t.fullscreen||t.mozFullScreen||t.webkitIsFullScreen||t.msFullscreenElement?(X.fullscreen.classList.add("pn-fullscreen-toggle-button-active"),M=!0):(X.fullscreen.classList.remove("pn-fullscreen-toggle-button-active"),M=!1),He("fullscreenchange",M),r.resize(),De(i.hfov),ye()}function Se(e){var t=i.minHfov;if("multires"==i.type&&r&&i.multiResMinHfov&&(t=Math.min(t,r.getCanvas().width/(i.multiRes.cubeResolution/90*.9))),t>i.maxHfov)return console.log("HFOV bounds do not make sense (minHfov > maxHfov)."),i.hfov;var a=i.hfov;if(a=e<t?t:e>i.maxHfov?i.maxHfov:e,i.avoidShowingBackground&&r){var o=r.getCanvas();a=Math.min(a,360*Math.atan(Math.tan((i.maxPitch-i.minPitch)/360*Math.PI)/o.height*o.width)/Math.PI)}return a}function De(e){i.hfov=Se(e),He("zoomchange",i.hfov)}function Ne(){A={},I=i.autoRotate?i.autoRotate:I,i.autoRotate=!1}function ke(){P&&(G.load.box.style.display="none",G.errorMsg.style.display="none",P=!1,He("errorcleared")),l=!1,X.load.style.display="none",G.load.box.style.display="inline",Z()}function Oe(e,t,o,s,c){var d,u,f,p;if(l=!1,A={},i.sceneFadeDuration&&!c){var m=r.render(i.pitch*Math.PI/180,i.yaw*Math.PI/180,i.hfov*Math.PI/180,{returnImage:!0});if(m!==a)return(d=new Image).className="pn-fade-img",d.style.transition="opacity "+i.sceneFadeDuration/1e3+"s",d.style.width="100%",d.style.height="100%",d.onload=function(){Oe(e,t,o,s,!0)},d.src=m,B.appendChild(d),void(r.fadeImg=d)}u="same"===t?i.pitch:t,f="same"===o?i.yaw:"sameAzimuth"===o?i.yaw+(i.northOffset||0)-(n.scenes[e].northOffset||0):o,p="same"===s?i.hfov:s,function(){var e=i.hotSpots;if(O=!1,delete i.hotSpots,e)for(var t=0;t<e.length;t++){for(var a=e[t].div;a.parentNode!=B;)a=a.parentNode;B.removeChild(a),delete e[t].div}}(),Le(e),_.yaw=_.pitch=_.hfov=0,Ce(),u!==a&&(i.pitch=u),f!==a&&(i.yaw=f),p!==a&&(i.hfov=p),He("scenechange",e),ke(),N=!0===i.dynamicUpdate,i.dynamic&&(h=i.panorama,K())}function Ue(){e.removeEventListener("deviceorientation",Me),X.orientation.classList.remove("pn-orientation-button-active"),L=!1}function Fe(){L=1,e.addEventListener("deviceorientation",Me),X.orientation.classList.add("pn-orientation-button-active")}function Be(e){return n.escapeHTML?String(e).split(/&/g).join("&amp;").split('"').join("&quot;").split("'").join("&#39;").split("<").join("&lt;").split(">").join("&gt;").split("/").join("&#x2f;").split("\n").join("<br>"):String(e).split("\n").join("<br>")}function ze(e){return 0===e.trim().toLowerCase().indexOf("javascript:")?"about:blank":e}function He(e){if(e in S)for(var t=S[e].length;t>0;t--)S[e][S[e].length-t].apply(null,[].slice.call(arguments,1))}xe.prototype.multiply=function(e){return new xe(this.w*e.w-this.x*e.x-this.y*e.y-this.z*e.z,this.x*e.w+this.w*e.x+this.y*e.z-this.z*e.y,this.y*e.w+this.w*e.y+this.z*e.x-this.x*e.z,this.z*e.w+this.w*e.z+this.x*e.y-this.y*e.x)},xe.prototype.toEulerAngles=function(){return[Math.atan2(2*(this.w*this.x+this.y*this.z),1-2*(this.x*this.x+this.y*this.y)),Math.asin(2*(this.w*this.y-this.z*this.x)),Math.atan2(2*(this.w*this.z+this.x*this.y),1-2*(this.y*this.y+this.z*this.z))]},this.isLoaded=function(){return Boolean(l)},this.getPitch=function(){return i.pitch},this.setPitch=function(e,t,o,n){return v=Date.now(),Math.abs(e-i.pitch)<=k?("function"==typeof o&&o(n),this):((t=t==a?1e3:Number(t))?(A.pitch={startTime:Date.now(),startPosition:i.pitch,endPosition:e,duration:t},"function"==typeof o&&setTimeout(function(){o(n)},t)):i.pitch=e,ye(),this)},this.getPitchBounds=function(){return[i.minPitch,i.maxPitch]},this.setPitchBounds=function(e){return i.minPitch=Math.max(-90,Math.min(e[0],90)),i.maxPitch=Math.max(-90,Math.min(e[1],90)),this},this.getYaw=function(){return i.yaw},this.setYaw=function(e,t,o,n){return v=Date.now(),Math.abs(e-i.yaw)<=k?("function"==typeof o&&o(n),this):(e=(e+180)%360-180,(t=t==a?1e3:Number(t))?(i.yaw-e>180?e+=360:e-i.yaw>180&&(e-=360),A.yaw={startTime:Date.now(),startPosition:i.yaw,endPosition:e,duration:t},"function"==typeof o&&setTimeout(function(){o(n)},t)):i.yaw=e,ye(),this)},this.getYawBounds=function(){return[i.minYaw,i.maxYaw]},this.setYawBounds=function(e){return i.minYaw=Math.max(-180,Math.min(e[0],180)),i.maxYaw=Math.max(-180,Math.min(e[1],180)),this},this.getHfov=function(){return i.hfov},this.setHfov=function(e,t,o,n){return v=Date.now(),Math.abs(e-i.hfov)<=k?("function"==typeof o&&o(n),this):((t=t==a?1e3:Number(t))?(A.hfov={startTime:Date.now(),startPosition:i.hfov,endPosition:Se(e),duration:t},"function"==typeof o&&setTimeout(function(){o(n)},t)):De(e),ye(),this)},this.getHfovBounds=function(){return[i.minHfov,i.maxHfov]},this.setHfovBounds=function(e){return i.minHfov=Math.max(0,e[0]),i.maxHfov=Math.max(0,e[1]),this},this.lookAt=function(e,t,o,n,r,s){return n=n==a?1e3:Number(n),e!==a&&Math.abs(e-i.pitch)>k&&(this.setPitch(e,n,r,s),r=a),t!==a&&Math.abs(t-i.yaw)>k&&(this.setYaw(t,n,r,s),r=a),o!==a&&Math.abs(o-i.hfov)>k&&(this.setHfov(o,n,r,s),r=a),"function"==typeof r&&r(s),this},this.getNorthOffset=function(){return i.northOffset},this.setNorthOffset=function(e){return i.northOffset=Math.min(360,Math.max(0,e)),ye(),this},this.getHorizonRoll=function(){return i.horizonRoll},this.setHorizonRoll=function(e){return i.horizonRoll=Math.min(90,Math.max(-90,e)),r.setPose(i.horizonPitch*Math.PI/180,i.horizonRoll*Math.PI/180),ye(),this},this.getHorizonPitch=function(){return i.horizonPitch},this.setHorizonPitch=function(e){return i.horizonPitch=Math.min(90,Math.max(-90,e)),r.setPose(i.horizonPitch*Math.PI/180,i.horizonRoll*Math.PI/180),ye(),this},this.startAutoRotate=function(e){return e=e||I||1,i.autoRotate=e,p.lookAt(f,a,u,3e3),ye(),this},this.stopAutoRotate=function(){return I=i.autoRotate?i.autoRotate:I,i.autoRotate=!1,i.autoRotateInactivityDelay=-1,this},this.getRenderer=function(){return r},this.setUpdate=function(e){return N=!0===e,r===a?K():ye(),this},this.mouseEventToCoords=function(e){return te(e)},this.loadScene=function(e,t,a,o){return!1!==l&&Oe(e,t,a,o),this},this.getScene=function(){return i.scene},this.addScene=function(e,t){return n.scenes[e]=t,this},this.removeScene=function(e){return!(i.scene===e||!n.scenes.hasOwnProperty(e))&&(delete n.scenes[e],!0)},this.toggleFullscreen=function(){return Ie(),this},this.getConfig=function(){return i},this.getContainer=function(){return o},this.addHotSpot=function(e,t){if(t===a&&i.scene===a)i.hotSpots.push(e);else{var o=t!==a?t:i.scene;if(!n.scenes.hasOwnProperty(o))throw"Invalid scene ID!";n.scenes[o].hasOwnProperty("hotSpots")||(n.scenes[o].hotSpots=[],o==i.scene&&(i.hotSpots=n.scenes[o].hotSpots)),n.scenes[o].hotSpots.push(e)}return t!==a&&i.scene!=t||(Re(e),l&&_e(e)),this},this.removeHotSpot=function(e,t){if(t===a||i.scene==t){if(!i.hotSpots)return!1;for(var o=0;o<i.hotSpots.length;o++)if(i.hotSpots[o].hasOwnProperty("id")&&i.hotSpots[o].id===e){for(var r=i.hotSpots[o].div;r.parentNode!=B;)r=r.parentNode;return B.removeChild(r),delete i.hotSpots[o].div,i.hotSpots.splice(o,1),!0}}else{if(!n.scenes.hasOwnProperty(t))return!1;if(!n.scenes[t].hasOwnProperty("hotSpots"))return!1;for(o=0;o<n.scenes[t].hotSpots.length;o++)if(n.scenes[t].hotSpots[o].hasOwnProperty("id")&&n.scenes[t].hotSpots[o].id===e)return n.scenes[t].hotSpots.splice(o,1),!0}},this.resize=function(){r&&we()},this.isLoaded=function(){return l},this.isOrientationSupported=function(){return W||!1},this.stopOrientation=function(){Ue()},this.startOrientation=function(){W&&Fe()},this.isOrientationActive=function(){return Boolean(L)},this.on=function(e,t){return S[e]=S[e]||[],S[e].push(t),this},this.off=function(e,t){if(!e)return S={},this;if(t){var a=S[e].indexOf(t);a>=0&&S[e].splice(a,1),0==S[e].length&&delete S[e]}else delete S[e];return this},this.destroy=function(){r&&r.destroy(),R&&(z.removeEventListener("mousedown",$,!1),z.removeEventListener("dblclick",ee,!1),t.removeEventListener("mousemove",ae,!1),t.removeEventListener("mouseup",oe,!1),o.removeEventListener("mousewheel",ue,!1),o.removeEventListener("DOMMouseScroll",ue,!1),o.removeEventListener("mozfullscreenchange",Ae,!1),o.removeEventListener("webkitfullscreenchange",Ae,!1),o.removeEventListener("msfullscreenchange",Ae,!1),o.removeEventListener("fullscreenchange",Ae,!1),e.removeEventListener("resize",we,!1),e.removeEventListener("orientationchange",we,!1),o.removeEventListener("keydown",fe,!1),o.removeEventListener("keyup",me,!1),o.removeEventListener("blur",pe,!1),t.removeEventListener("mouseleave",oe,!1),z.removeEventListener("touchstart",ne,!1),z.removeEventListener("touchmove",ie,!1),z.removeEventListener("touchend",re,!1),z.removeEventListener("pointerdown",he,!1),z.removeEventListener("pointermove",ce,!1),z.removeEventListener("pointerup",de,!1),z.removeEventListener("pointerleave",de,!1)),o.innerHTML="",o.classList.remove("pn-container"),F.classList.remove("pn-grab"),F.classList.remove("pn-grabbing")}}return{viewer:function(e,t){return new o(e,t)}}}(window,document),"file:"==window.location.protocol?anError("Due to browser security restrictions, pn can't be run from the local filesystem; some sort of web server must be used."):parseURLParameters();
